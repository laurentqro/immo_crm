# XBRL Output Contract

**Branch**: `012-amsf-taxonomy-compliance`
**Date**: 2024-12-03

## Overview

This document specifies the contract for XBRL output generated by the `XbrlGenerator` service. The output must conform to the AMSF strix taxonomy (2025 version).

## Document Structure

```xml
<?xml version="1.0" encoding="UTF-8"?>
<xbrl xmlns="http://www.xbrl.org/2003/instance"
      xmlns:link="http://www.xbrl.org/2003/linkbase"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      xmlns:iso4217="http://www.xbrl.org/2003/iso4217"
      xmlns:strix="http://amsf.mc/fr/taxonomy/strix"
      xmlns:xbrli="http://www.xbrl.org/2003/instance">

  <!-- Schema Reference -->
  <link:schemaRef xlink:type="simple"
                  xlink:href="http://amsf.mc/fr/taxonomy/strix/2025/strix.xsd"/>

  <!-- Contexts -->
  <context id="ctx_entity">...</context>
  <context id="ctx_country_FR">...</context>

  <!-- Units -->
  <unit id="unit_EUR">...</unit>
  <unit id="unit_pure">...</unit>

  <!-- Facts -->
  <strix:a1101 contextRef="ctx_entity" unitRef="unit_pure">42</strix:a1101>

</xbrl>
```

## Required Namespaces

| Prefix | URI | Purpose |
|--------|-----|---------|
| (default) | `http://www.xbrl.org/2003/instance` | XBRL instance |
| `link` | `http://www.xbrl.org/2003/linkbase` | Link elements |
| `xlink` | `http://www.w3.org/1999/xlink` | XLink attributes |
| `iso4217` | `http://www.xbrl.org/2003/iso4217` | Currency codes |
| `strix` | `http://amsf.mc/fr/taxonomy/strix` | AMSF taxonomy |
| `xbrli` | `http://www.xbrl.org/2003/instance` | XBRL types |

## Context Specifications

### Entity Context (Required)

```xml
<context id="ctx_entity">
  <entity>
    <identifier scheme="http://amsf.mc/rci">{RCI_NUMBER}</identifier>
  </entity>
  <period>
    <instant>{YEAR}-12-31</instant>
  </period>
</context>
```

| Field | Description | Example |
|-------|-------------|---------|
| `id` | Context identifier | `ctx_entity` |
| `scheme` | Entity identification scheme | `http://amsf.mc/rci` |
| `identifier` | Organization RCI number | `123456789` |
| `instant` | Reporting date | `2024-12-31` |

### Dimensional Context (For Country Breakdowns)

```xml
<context id="ctx_country_{CODE}">
  <entity>
    <identifier scheme="http://amsf.mc/rci">{RCI_NUMBER}</identifier>
    <segment>
      <strix:CountryDimension>{CODE}</strix:CountryDimension>
    </segment>
  </entity>
  <period>
    <instant>{YEAR}-12-31</instant>
  </period>
</context>
```

| Field | Description | Example |
|-------|-------------|---------|
| `id` | Context identifier | `ctx_country_FR` |
| `CODE` | ISO 3166-1 alpha-2 country code | `FR`, `GB`, `DE` |
| `CountryDimension` | Dimensional member | Country code value |

## Unit Specifications

### EUR Unit (Monetary Values)

```xml
<unit id="unit_EUR">
  <iso4217:EUR/>
</unit>
```

### Pure Unit (Counts/Integers)

```xml
<unit id="unit_pure">
  <xbrli:pure/>
</unit>
```

## Fact Specifications

### Integer Facts

```xml
<strix:{ELEMENT_NAME} contextRef="{CONTEXT_ID}" unitRef="unit_pure">{VALUE}</strix:{ELEMENT_NAME}>
```

Example:
```xml
<strix:a1101 contextRef="ctx_entity" unitRef="unit_pure">42</strix:a1101>
```

### Monetary Facts

```xml
<strix:{ELEMENT_NAME} contextRef="{CONTEXT_ID}" unitRef="unit_EUR" decimals="2">{VALUE}</strix:{ELEMENT_NAME}>
```

Example:
```xml
<strix:a2104B contextRef="ctx_entity" unitRef="unit_EUR" decimals="2">150000.00</strix:a2104B>
```

### Enumeration Facts (French Boolean)

```xml
<strix:{ELEMENT_NAME} contextRef="{CONTEXT_ID}">{VALUE}</strix:{ELEMENT_NAME}>
```

Example:
```xml
<strix:a11001BTOLA contextRef="ctx_entity">Oui</strix:a11001BTOLA>
```

| Allowed Values | Meaning |
|----------------|---------|
| `Oui` | True/Yes |
| `Non` | False/No |

### Dimensional Facts (Country Breakdown)

```xml
<strix:a1103 contextRef="ctx_country_FR" unitRef="unit_pure">10</strix:a1103>
<strix:a1103 contextRef="ctx_country_GB" unitRef="unit_pure">5</strix:a1103>
```

Note: Same element name (`a1103`), different `contextRef` for each country.

## Element Name Contract

All element names MUST exist in the official taxonomy (`docs/strix_Real_Estate_AML_CFT_survey_2025.xsd`).

### Valid Element Names (Partial List)

| Element | Type | Description |
|---------|------|-------------|
| `a1101` | integer | Total clients |
| `a1102` | integer | Natural person clients |
| `a1103` | integer | Natural persons by country (dimensional) |
| `a11502B` | integer | Legal entity clients |
| `a11802B` | integer | Trust clients |
| `a12002B` | integer | PEP clients |
| `a1501` | integer | Beneficial owners identified |
| `a1502B` | integer | PEP beneficial owners |
| `a2101B` | integer | Total transactions |
| `a2102B` | integer | Purchase transactions |
| `a2102BB` | monetary | Purchase value |
| `a2104B` | monetary | Total transaction value |
| `a2105B` | integer | Sale transactions |
| `a2105BB` | monetary | Sale value |
| `a2107B` | integer | Rental transactions |
| `a2107BB` | monetary | Rental value |
| `a2203` | integer | Cash transactions |
| `a2202` | monetary | Cash amount |
| `a2501A` | integer | Virtual asset transactions |
| `a3101` | integer | STRs filed |

### Invalid Element Names (Must NOT Appear)

These element names must never appear in output:

- `a1301`, `a1502`, `a2102`, `a2103`, `a2104`, `a2105`, `a2106`, `a2107`
- `a2201`, `a2301`, `a2302`, `a2401`
- `a0101-a0104`, `a1001-a1003`
- Any underscore-suffixed country elements (`a1103_FR`, `a1103_GB`, etc.)

## Validation Rules

1. **Well-formed XML**: Document must parse without errors
2. **Element existence**: All element names must exist in taxonomy XSD
3. **Context references**: Every `contextRef` must point to existing context
4. **Unit references**: Numeric facts must have valid `unitRef`
5. **Type conformance**: Values must match element type definitions
6. **French booleans**: Enum elements must use `Oui`/`Non`
7. **Country codes**: Dimensional contexts must use valid ISO 3166-1 alpha-2 codes
