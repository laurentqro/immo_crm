<%= content_for :title, "Review #{@submission.year} Submission" %>

<div class="container mx-auto px-4 py-8" data-controller="survey-filter">
  <%# Header with navigation and status %>
  <div class="mb-6 flex justify-between items-center">
    <%= link_to "â† Back to Submission", submission_path(@submission), class: "text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300" %>
    <span class="px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full <%= @submission.status_badge_class %>">
      <%= @submission.status %>
    </span>
  </div>

  <%# Page header %>
  <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg mb-6">
    <div class="px-4 py-5 sm:px-6">
      <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Review AMSF Survey</h1>
      <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
        <%= @organization.name %> &mdash; <%= @submission.year %> Annual Submission
      </p>
    </div>
  </div>

  <%# Search and filter controls (US2/US3 will enhance this) %>
  <div class="bg-white dark:bg-gray-800 shadow sm:rounded-lg mb-6 p-4">
    <div class="flex flex-wrap gap-4 items-center">
      <%# Search input (T031) %>
      <div class="flex-1 min-w-[200px]">
        <label for="search" class="sr-only">Search elements</label>
        <input type="text"
               id="search"
               placeholder="Search by element name or label..."
               class="w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:placeholder-gray-400"
               data-survey-filter-target="search"
               data-action="input->survey-filter#filterDebounced">
      </div>

      <%# Needs review filter toggle (T036) %>
      <div class="flex items-center">
        <input type="checkbox"
               id="needs-review-only"
               class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 focus:ring-blue-500"
               data-survey-filter-target="needsReviewOnly"
               data-action="change->survey-filter#filter">
        <label for="needs-review-only" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
          Needs review only
        </label>
      </div>

      <%# Element count display (T033) %>
      <div class="text-sm text-gray-500 dark:text-gray-400">
        <span data-survey-filter-target="count"><%= @sections.sum { |s| s[:elements].size } %></span> elements
      </div>
    </div>
  </div>

  <%# Survey sections with elements %>
  <div class="space-y-6" data-survey-filter-target="sections">
    <% @sections.each do |section| %>
      <%= render partial: "survey_reviews/section", locals: { section: section } %>
    <% end %>
  </div>

  <%# Complete submission button - only show for validated submissions (T045-T048) %>
  <% if @submission.validated? %>
    <div class="mt-8 flex justify-end">
      <%= button_to "Complete Submission",
                    submission_complete_review_path(@submission),
                    method: :post,
                    class: "btn btn-primary",
                    data: { turbo_confirm: "Are you sure you want to complete this submission? This action cannot be undone." } %>
    </div>
  <% elsif @submission.completed? %>
    <div class="mt-8 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 rounded-lg p-4">
      <div class="flex items-center">
        <svg class="h-5 w-5 text-green-400 dark:text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
        <span class="text-green-700 dark:text-green-300 font-medium">Submission completed on <%= @submission.completed_at&.strftime("%B %d, %Y at %H:%M") %></span>
      </div>
    </div>
  <% end %>
</div>
