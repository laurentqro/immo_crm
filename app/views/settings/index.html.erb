<% Current.meta_tags.set(title: "Settings") %>

<div class="px-4 sm:px-6 lg:px-8">
  <div class="sm:flex sm:items-center">
    <div class="sm:flex-auto">
      <h1 class="text-2xl font-semibold leading-6 text-gray-900 dark:text-white">Settings</h1>
      <p class="mt-2 text-sm text-gray-700 dark:text-gray-300">
        Configure your organization's AML/CFT compliance settings.
        <%= current_organization.name %>
      </p>
    </div>
    <div class="mt-4 sm:ml-16 sm:mt-0 sm:flex-none autosave-indicator">
      <span class="text-sm text-gray-500 dark:text-gray-400">
        Settings auto-save when changed
      </span>
    </div>
  </div>

  <%# Category Tabs %>
  <div class="mt-6 border-b border-gray-200 dark:border-gray-700">
    <nav class="-mb-px flex space-x-8" aria-label="Settings categories">
      <%= link_to "Entity Information", settings_path(category: "entity_info"),
          class: "category-tab whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium #{@current_category == 'entity_info' ? 'active border-primary-500 text-primary-600 dark:text-primary-400' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400'}" %>
      <%= link_to "KYC Procedures", settings_path(category: "kyc_procedures"),
          class: "category-tab whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium #{@current_category == 'kyc_procedures' ? 'active border-primary-500 text-primary-600 dark:text-primary-400' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400'}" %>
      <%= link_to "Compliance Policies", settings_path(category: "compliance_policies"),
          class: "category-tab whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium #{@current_category == 'compliance_policies' ? 'active border-primary-500 text-primary-600 dark:text-primary-400' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400'}" %>
      <%= link_to "Training", settings_path(category: "training"),
          class: "category-tab whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium #{@current_category == 'training' ? 'active border-primary-500 text-primary-600 dark:text-primary-400' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400'}" %>
    </nav>
  </div>

  <%# Settings Form %>
  <%= turbo_frame_tag "settings_form" do %>
    <%= form_with url: settings_path, method: :patch, local: true, class: "mt-8 space-y-10" do |f| %>
      <%# Entity Information Section %>
      <div id="entity_info" class="settings-category entity-info-section">
        <h2 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Entity Information</h2>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
          Basic information about your real estate agency for AMSF reporting.
        </p>
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
          <div>
            <%= label_tag :entity_name, "Entity Name", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
            <%= text_field_tag "settings[entity_name]", get_setting_value("entity_name"),
                id: "entity_name", name: "settings[entity_name]",
                class: "mt-1 form-control" %>
            <p class="mt-1 text-xs text-gray-500">XBRL: a0101</p>
          </div>
          <div>
            <%= label_tag :total_employees, "Total Employees", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
            <%= number_field_tag "settings[total_employees]", get_setting_value("total_employees"),
                id: "total_employees", name: "settings[total_employees]",
                class: "mt-1 form-control", min: 0 %>
            <p class="mt-1 text-xs text-gray-500">XBRL: a0102</p>
          </div>
          <div>
            <%= label_tag :compliance_officers, "Compliance Officers", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
            <%= number_field_tag "settings[compliance_officers]", get_setting_value("compliance_officers"),
                id: "compliance_officers", name: "settings[compliance_officers]",
                class: "mt-1 form-control", min: 0 %>
            <p class="mt-1 text-xs text-gray-500">XBRL: a0103</p>
          </div>
          <div>
            <%= label_tag :annual_revenue, "Annual Revenue", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
            <%= number_field_tag "settings[annual_revenue]", get_setting_value("annual_revenue"),
                id: "annual_revenue", name: "settings[annual_revenue]",
                class: "mt-1 form-control", min: 0, step: "0.01" %>
            <p class="mt-1 text-xs text-gray-500">XBRL: a0104</p>
          </div>
        </div>
      </div>

      <%# KYC Procedures Section %>
      <div id="kyc_procedures" class="settings-category kyc-procedures-section">
        <h2 class="text-lg font-medium text-gray-900 dark:text-white mb-4">KYC Procedures</h2>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
          Enhanced Due Diligence (EDD) and Simplified Due Diligence (SDD) settings.
          <span class="font-medium">a4101</span> - XBRL element code for reference.
        </p>
        <div class="space-y-4">
          <div class="flex items-start">
            <%= hidden_field_tag "settings[edd_for_peps]", "false" %>
            <%= check_box_tag "settings[edd_for_peps]", "true", get_setting_value("edd_for_peps") == "true",
                id: "edd_for_peps", name: "settings[edd_for_peps]",
                class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1" %>
            <%= label_tag :edd_for_peps, class: "ml-3" do %>
              <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">EDD for PEPs</span>
              <span class="block text-sm text-gray-500 dark:text-gray-400">Apply Enhanced Due Diligence for Politically Exposed Persons</span>
            <% end %>
          </div>
          <div class="flex items-start">
            <%= hidden_field_tag "settings[edd_for_high_risk_countries]", "false" %>
            <%= check_box_tag "settings[edd_for_high_risk_countries]", "true", get_setting_value("edd_for_high_risk_countries") == "true",
                id: "edd_for_high_risk_countries", name: "settings[edd_for_high_risk_countries]",
                class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1" %>
            <%= label_tag :edd_for_high_risk_countries, class: "ml-3" do %>
              <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">EDD for High-Risk Countries</span>
              <span class="block text-sm text-gray-500 dark:text-gray-400">Apply Enhanced Due Diligence for clients from high-risk jurisdictions</span>
            <% end %>
          </div>
          <div class="flex items-start">
            <%= hidden_field_tag "settings[edd_for_complex_structures]", "false" %>
            <%= check_box_tag "settings[edd_for_complex_structures]", "true", get_setting_value("edd_for_complex_structures") == "true",
                id: "edd_for_complex_structures", name: "settings[edd_for_complex_structures]",
                class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1" %>
            <%= label_tag :edd_for_complex_structures, class: "ml-3" do %>
              <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">EDD for Complex Structures</span>
              <span class="block text-sm text-gray-500 dark:text-gray-400">Apply Enhanced Due Diligence for complex ownership structures</span>
            <% end %>
          </div>
          <div class="flex items-start">
            <%= hidden_field_tag "settings[sdd_applied]", "false" %>
            <%= check_box_tag "settings[sdd_applied]", "true", get_setting_value("sdd_applied") == "true",
                id: "sdd_applied", name: "settings[sdd_applied]",
                class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1" %>
            <%= label_tag :sdd_applied, class: "ml-3" do %>
              <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">Simplified Due Diligence (SDD)</span>
              <span class="block text-sm text-gray-500 dark:text-gray-400">Apply simplified procedures for low-risk situations</span>
            <% end %>
          </div>
        </div>
      </div>

      <%# Compliance Policies Section %>
      <div id="compliance_policies" class="settings-category compliance-policies-section">
        <h2 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Compliance Policies</h2>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
          Your organization's AML/CFT policy documentation status.
        </p>
        <div class="space-y-6">
          <div class="flex items-start">
            <%= hidden_field_tag "settings[written_aml_policy]", "false" %>
            <%= check_box_tag "settings[written_aml_policy]", "true", get_setting_value("written_aml_policy") == "true",
                id: "written_aml_policy", name: "settings[written_aml_policy]",
                class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1" %>
            <%= label_tag :written_aml_policy, class: "ml-3" do %>
              <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">Written AML Policy</span>
              <span class="block text-sm text-gray-500 dark:text-gray-400">Organization has documented AML/CFT policies</span>
            <% end %>
          </div>
          <div>
            <%= label_tag :policy_last_updated, "Policy Last Updated", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
            <%= date_field_tag "settings[policy_last_updated]", get_setting_value("policy_last_updated"),
                id: "policy_last_updated", name: "settings[policy_last_updated]",
                class: "mt-1 form-control max-w-xs" %>
          </div>
          <div class="flex items-start">
            <%= hidden_field_tag "settings[risk_assessment_performed]", "false" %>
            <%= check_box_tag "settings[risk_assessment_performed]", "true", get_setting_value("risk_assessment_performed") == "true",
                id: "risk_assessment_performed", name: "settings[risk_assessment_performed]",
                class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1" %>
            <%= label_tag :risk_assessment_performed, class: "ml-3" do %>
              <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">Risk Assessment Performed</span>
              <span class="block text-sm text-gray-500 dark:text-gray-400">Organizational risk assessment has been completed</span>
            <% end %>
          </div>
          <div class="flex items-start">
            <%= hidden_field_tag "settings[internal_controls]", "false" %>
            <%= check_box_tag "settings[internal_controls]", "true", get_setting_value("internal_controls") == "true",
                id: "internal_controls", name: "settings[internal_controls]",
                class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1" %>
            <%= label_tag :internal_controls, class: "ml-3" do %>
              <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">Internal Controls</span>
              <span class="block text-sm text-gray-500 dark:text-gray-400">Internal control procedures are documented and implemented</span>
            <% end %>
          </div>
        </div>
      </div>

      <%# Training Section %>
      <div id="training" class="settings-category training-section">
        <h2 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Training</h2>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
          Staff training and awareness program details.
        </p>
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
          <div>
            <%= label_tag :training_frequency, "Training Frequency", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
            <%= select_tag "settings[training_frequency]",
                options_for_select([
                  ["Annual", "annual"],
                  ["Biannual", "biannual"],
                  ["Quarterly", "quarterly"],
                  ["Monthly", "monthly"]
                ], get_setting_value("training_frequency")),
                id: "training_frequency", name: "settings[training_frequency]",
                class: "mt-1 form-control max-w-xs" %>
          </div>
          <div>
            <%= label_tag :last_training_date, "Last Training Date", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
            <%= date_field_tag "settings[last_training_date]", get_setting_value("last_training_date"),
                id: "last_training_date", name: "settings[last_training_date]",
                class: "mt-1 form-control max-w-xs" %>
          </div>
          <div class="col-span-full flex items-start">
            <%= hidden_field_tag "settings[training_covers_aml]", "false" %>
            <%= check_box_tag "settings[training_covers_aml]", "true", get_setting_value("training_covers_aml") == "true",
                id: "training_covers_aml", name: "settings[training_covers_aml]",
                class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1" %>
            <%= label_tag :training_covers_aml, class: "ml-3" do %>
              <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">Training Covers AML/CFT</span>
              <span class="block text-sm text-gray-500 dark:text-gray-400">Training program includes AML/CFT compliance topics</span>
            <% end %>
          </div>
        </div>
      </div>

      <%# Submit Button %>
      <div class="pt-5 border-t border-gray-200 dark:border-gray-700">
        <div class="flex justify-end">
          <%= submit_tag "Save Settings", class: "btn btn-primary" %>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
