<% Current.meta_tags.set(title: "Compliance Settings") %>

<div class="px-4 sm:px-6 lg:px-8">
  <div class="sm:flex sm:items-center">
    <div class="sm:flex-auto">
      <h1 class="text-2xl font-semibold leading-6 text-gray-900 dark:text-white">Compliance Settings</h1>
      <p class="mt-2 text-sm text-gray-700 dark:text-gray-300">
        Configure your organization's AML/CFT compliance settings.
      </p>
    </div>
    <div class="mt-4 sm:ml-16 sm:mt-0 sm:flex-none">
      <span class="text-sm text-gray-500 dark:text-gray-400">
        Click "Save Settings" to apply changes
      </span>
    </div>
  </div>

  <%# Settings Form with Tabs Controller %>
  <%= form_with url: settings_path, method: :patch, local: true, class: "mt-6" do |f| %>
    <div data-controller="tabs" data-tabs-active-tab-class="border-primary-500 text-primary-600 dark:text-primary-400" data-tabs-inactive-tab-class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400">
      <%# Category Tabs %>
      <div class="border-b border-gray-200 dark:border-gray-700">
        <nav class="-mb-px flex space-x-8" aria-label="Settings categories">
          <a href="#" data-tabs-target="tab" data-action="click->tabs#change:prevent" class="whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium border-primary-500 text-primary-600 dark:text-primary-400">Entity Information</a>
          <a href="#" data-tabs-target="tab" data-action="click->tabs#change:prevent" class="whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400">KYC Procedures</a>
          <a href="#" data-tabs-target="tab" data-action="click->tabs#change:prevent" class="whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400">Compliance Policies</a>
        </nav>
      </div>

      <%# Tab Panels %>
      <div class="mt-8">
        <%# Entity Information Panel %>
        <div data-tabs-target="panel" id="entity_info" class="settings-category">
          <h2 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Entity Information</h2>
          <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
            Basic information about your real estate agency for AMSF reporting.
          </p>
          <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
            <div>
              <%= label_tag :entity_name, "Entity Name", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
              <%= text_field_tag "settings[entity_name]", get_setting_value("entity_name"),
                  id: "entity_name", name: "settings[entity_name]",
                  class: "mt-1 form-control" %>
            </div>
            <div>
              <%= label_tag :legal_form, "Legal Form", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
              <%= select_tag "settings[legal_form]",
                  options_for_select([
                    ["Select legal form...", ""],
                    ["Société Anonyme Monégasque (SAM)", "SAM"],
                    ["Société à Responsabilité Limitée (SARL)", "SARL"],
                    ["Société Civile Immobilière (SCI)", "SCI"],
                    ["Société Civile Particulière (SCP)", "SCP"],
                    ["Société en Nom Collectif (SNC)", "SNC"],
                    ["Société en Commandite Simple (SCS)", "SCS"],
                    ["Société en Commandite par Actions (SCA)", "SCA"],
                    ["Entreprise Individuelle (EI)", "EI"],
                    ["Groupement d'Intérêt Économique (GIE)", "GIE"],
                    ["Association Monégasque (AM)", "AM"],
                    ["Fondation Monégasque (FM)", "FM"],
                    ["Trust", "TRUST"],
                    ["Autres sociétés civiles", "ASC"],
                    ["Autres arrangements juridiques", "AAJ"],
                    ["Domaine Privé de l'État Monégasque", "DPE"],
                    ["Inconnu", "INCONNU"]
                  ], get_setting_value("legal_form")),
                  id: "legal_form", name: "settings[legal_form]",
                  class: "mt-1 form-control" %>
            </div>
            <div>
              <%= label_tag :total_employees, "Total Employees", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
              <%= number_field_tag "settings[total_employees]", get_setting_value("total_employees"),
                  id: "total_employees", name: "settings[total_employees]",
                  class: "mt-1 form-control", min: 0 %>
            </div>
            <div>
              <%= label_tag :compliance_officers, "Compliance Officers", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
              <%= number_field_tag "settings[compliance_officers]", get_setting_value("compliance_officers"),
                  id: "compliance_officers", name: "settings[compliance_officers]",
                  class: "mt-1 form-control", min: 0 %>
            </div>
            <div>
              <%= label_tag :annual_revenue, "Annual Revenue", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
              <%= number_field_tag "settings[annual_revenue]", get_setting_value("annual_revenue"),
                  id: "annual_revenue", name: "settings[annual_revenue]",
                  class: "mt-1 form-control", min: 0, step: "0.01" %>
            </div>
          </div>
        </div>

        <%# KYC Procedures Panel %>
        <div data-tabs-target="panel" id="kyc_procedures" class="settings-category hidden">
          <h2 class="text-lg font-medium text-gray-900 dark:text-white mb-4">KYC Procedures</h2>
          <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
            Enhanced Due Diligence (EDD) and Simplified Due Diligence (SDD) settings.
          </p>
          <div class="space-y-4">
            <div class="flex items-start">
              <%= hidden_field_tag "settings[edd_for_peps]", "false" %>
              <%= check_box_tag "settings[edd_for_peps]", "true", get_setting_value("edd_for_peps") == "true",
                  id: "edd_for_peps", name: "settings[edd_for_peps]",
                  class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1",
                  aria: { describedby: "edd_for_peps_description" } %>
              <%= label_tag :edd_for_peps, class: "ml-3" do %>
                <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">EDD for PEPs</span>
                <span id="edd_for_peps_description" class="block text-sm text-gray-500 dark:text-gray-400">Apply Enhanced Due Diligence for Politically Exposed Persons</span>
              <% end %>
            </div>
            <div class="flex items-start">
              <%= hidden_field_tag "settings[edd_for_high_risk_countries]", "false" %>
              <%= check_box_tag "settings[edd_for_high_risk_countries]", "true", get_setting_value("edd_for_high_risk_countries") == "true",
                  id: "edd_for_high_risk_countries", name: "settings[edd_for_high_risk_countries]",
                  class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1",
                  aria: { describedby: "edd_for_high_risk_countries_description" } %>
              <%= label_tag :edd_for_high_risk_countries, class: "ml-3" do %>
                <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">EDD for High-Risk Countries</span>
                <span id="edd_for_high_risk_countries_description" class="block text-sm text-gray-500 dark:text-gray-400">Apply Enhanced Due Diligence for clients from high-risk jurisdictions</span>
              <% end %>
            </div>
            <div class="flex items-start">
              <%= hidden_field_tag "settings[edd_for_complex_structures]", "false" %>
              <%= check_box_tag "settings[edd_for_complex_structures]", "true", get_setting_value("edd_for_complex_structures") == "true",
                  id: "edd_for_complex_structures", name: "settings[edd_for_complex_structures]",
                  class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1",
                  aria: { describedby: "edd_for_complex_structures_description" } %>
              <%= label_tag :edd_for_complex_structures, class: "ml-3" do %>
                <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">EDD for Complex Structures</span>
                <span id="edd_for_complex_structures_description" class="block text-sm text-gray-500 dark:text-gray-400">Apply Enhanced Due Diligence for complex ownership structures</span>
              <% end %>
            </div>
            <div class="flex items-start">
              <%= hidden_field_tag "settings[sdd_applied]", "false" %>
              <%= check_box_tag "settings[sdd_applied]", "true", get_setting_value("sdd_applied") == "true",
                  id: "sdd_applied", name: "settings[sdd_applied]",
                  class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1",
                  aria: { describedby: "sdd_applied_description" } %>
              <%= label_tag :sdd_applied, class: "ml-3" do %>
                <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">Simplified Due Diligence (SDD)</span>
                <span id="sdd_applied_description" class="block text-sm text-gray-500 dark:text-gray-400">Apply simplified procedures for low-risk situations</span>
              <% end %>
            </div>
          </div>
        </div>

        <%# Compliance Policies Panel %>
        <div data-tabs-target="panel" id="compliance_policies" class="settings-category hidden">
          <h2 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Compliance Policies</h2>
          <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
            Your organization's AML/CFT policy documentation status.
          </p>
          <div class="space-y-6">
            <div class="flex items-start">
              <%= hidden_field_tag "settings[written_aml_policy]", "false" %>
              <%= check_box_tag "settings[written_aml_policy]", "true", get_setting_value("written_aml_policy") == "true",
                  id: "written_aml_policy", name: "settings[written_aml_policy]",
                  class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1",
                  aria: { describedby: "written_aml_policy_description" } %>
              <%= label_tag :written_aml_policy, class: "ml-3" do %>
                <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">Written AML Policy</span>
                <span id="written_aml_policy_description" class="block text-sm text-gray-500 dark:text-gray-400">Organization has documented AML/CFT policies</span>
              <% end %>
            </div>
            <div>
              <%= label_tag :policy_last_updated, "Policy Last Updated", class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
              <%= date_field_tag "settings[policy_last_updated]", get_setting_value("policy_last_updated"),
                  id: "policy_last_updated", name: "settings[policy_last_updated]",
                  class: "mt-1 form-control max-w-xs" %>
            </div>
            <div class="flex items-start">
              <%= hidden_field_tag "settings[risk_assessment_performed]", "false" %>
              <%= check_box_tag "settings[risk_assessment_performed]", "true", get_setting_value("risk_assessment_performed") == "true",
                  id: "risk_assessment_performed", name: "settings[risk_assessment_performed]",
                  class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1",
                  aria: { describedby: "risk_assessment_performed_description" } %>
              <%= label_tag :risk_assessment_performed, class: "ml-3" do %>
                <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">Risk Assessment Performed</span>
                <span id="risk_assessment_performed_description" class="block text-sm text-gray-500 dark:text-gray-400">Organizational risk assessment has been completed</span>
              <% end %>
            </div>
            <div class="flex items-start">
              <%= hidden_field_tag "settings[internal_controls]", "false" %>
              <%= check_box_tag "settings[internal_controls]", "true", get_setting_value("internal_controls") == "true",
                  id: "internal_controls", name: "settings[internal_controls]",
                  class: "h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500 mt-1",
                  aria: { describedby: "internal_controls_description" } %>
              <%= label_tag :internal_controls, class: "ml-3" do %>
                <span class="block text-sm font-medium text-gray-700 dark:text-gray-300">Internal Controls</span>
                <span id="internal_controls_description" class="block text-sm text-gray-500 dark:text-gray-400">Internal control procedures are documented and implemented</span>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <%# Submit Button %>
      <div class="mt-10 pt-5 border-t border-gray-200 dark:border-gray-700">
        <div class="flex justify-end">
          <%= submit_tag "Save Settings", class: "btn btn-primary" %>
        </div>
      </div>
    </div>
  <% end %>
</div>
